# 小说网站未覆盖的企业级 Java 知识点（基于仓库扫描 2025-12-27 16:58:30）

> 依据当前代码与依赖（例如 `web/pom.xml`, `web/src/main/java`, `common/src/main/java`, `persistent/pp_novel.sql`）梳理，下面列出尚未实践或仅触及皮毛的 Java 基础与中间件能力，并给出可落地到小说网站的需求思路。

## 项目已覆盖的基线
- Spring Boot + MyBatis-Plus 单体，含分页插件与基础实体填充（`common/src/main/java/org/ppnovel/common/entity/BaseEntity.java`）。
- Redis 仅做简单 KV/Hash（`web/src/main/java/org/ppnovel/web/component/RedisUtil.java`），未做缓存策略。
- RabbitMQ 只用于注册邮件异步发送（`web/src/main/java/org/ppnovel/web/configuration/RabbitConfiguration.java`, `web/src/main/java/org/ppnovel/web/service/email/*`）。
- 对象存储预签名上传（S3/OSS）（`web/src/main/java/org/ppnovel/web/service/upload/*`）。
- 登录校验用 Sa-Token，全局拦截但无角色/权限细分（`web/src/main/java/org/ppnovel/web/configuration/SaTokenConfigure.java`）。
- 仅少量 `@Transactional`（`web/src/main/java/org/ppnovel/web/service/novel/WriterNovelService.java`），无测试目录、无 Docker/CI。

## 尚未覆盖 / 可加强的知识点与落地玩法

### Java 语言与并发
- 高精度货币与扣费结算：全局未使用 `BigDecimal`，现有数量字段多为 `Integer/Long`。可在付费章节、月票/打赏分成中实践金额精度、舍入模式、比较与格式化。
- 并发工具与线程池调优：仅有 `@Async`（`web/src/main/java/org/ppnovel/web/service/user/UserInitService.java`），没有 `ExecutorService`、`CompletableFuture`、`Lock`、`Semaphore` 等。可用在排行榜批量计算、全量索引重建、批量推送等任务的并发拆分、超时取消、背压。
- 线程本地与请求上下文管理：未见 `ThreadLocal`/`InheritableThreadLocal` 使用。可用于链路打标、灰度标识传递（慎用并需清理）。
- NIO/文件流与 `try-with-resources`：未见 `java.nio.file.Files` 等。可实现「导出作者收益报表」「批量导入章节草稿」时的流式读写、编码控制与自动关闭资源。
- JDK 21 特性：未用 `record`、`sealed`、模式匹配等，可在 DTO/VO、策略分发中练习减少样板代码与增加类型安全。

### 数据层与事务
- 事务传播/隔离/回滚策略：除小说写作流程外未做事务边界设计，未覆盖传播行为、只读事务、异常回滚策略。可在「购买+扣余额+发放章节访问权」或「作者结算对账」中练习。
- 数据版本控制/乐观锁：实体未使用 `@Version`。可在「多人协同改稿」「并发更新章节状态」中防止覆盖写。
- 批处理与批量写：未使用 MyBatis-Plus `saveBatch`/自定义批量 SQL。可支持「批量导入分类/标签」「运营批量调整状态」。
- 多数据源/读写分离/分库分表：当前单库单源，可在「评论、阅读历史」等高写入场景练习读写分离、分片键设计、ShardingSphere。
- 数据库变更管理：依赖手工 SQL（`persistent/pp_novel.sql`），未用 Flyway/Liquibase。可按「新增表/字段」「历史脚本回滚」等场景搭建版本化迁移。

### 缓存与 Redis 进阶
- 业务缓存与一致性：无 `@Cacheable`/`CacheManager`，也未设计缓存失效/预热策略。可为「首页榜单」「作者主页」做多级缓存、主动失效、旁路缓存与缓存击穿保护。
- 分布式锁/原子性：未使用 Lua/Redisson/SET NX。可在「库存型资源（限免名额、活动券）」「防重复提交」中实践。
- 布隆过滤器、BitMap、HyperLogLog：适合「爬虫拦截」「UV 统计」「推送去重」。
- Redis Stream / PubSub：可做「站内信实时推送」「评论流」「审核异步流水」。

### 消息、事件与任务调度
- MQ 进阶特性：目前只有直连队列，无延迟队列、死信队列、重试/幂等等策略。可在「定时发送未读通知」「失败邮件重试」「内容审核异步回执」中演练。
- 事件驱动架构：业务未抽象领域事件。可将「章节发布」「评论新增」「用户关注」发布成事件供统计、推荐、通知、风控订阅。
- 定时/批处理：项目未出现 `@Scheduled`/Quartz/xxl-job。可用于「凌晨重建榜单」「每天生成作者结算单」「清理过期验证码/草稿」。
- 流式/日志管道：无 Kafka/Pulsar/SLS。可在「阅读事件埋点」->「实时推荐/热度榜」中实践日志采集与流处理。

### 接口安全与网关
- 权限模型：Sa-Token 仅校验登录，无角色/权限注解。可设计角色（读者/作者/审核/运营）、资源级权限、数据隔离、后台接口保护。
- 流量治理：缺少限流/熔断/降级（Resilience4j/RateLimiter）、幂等性 Token、防刷验证码。适用于「登录注册」「章节购买」「弹窗接口」。
- 输入安全：无 XSS/SQL 注入防护库、文件安全扫描。可在「富文本投稿」「封面上传」引入内容过滤、病毒扫描、MIME 校验、大小/维度检测。
- API 版本与签名：未做接口版本管理/签名校验。可为「开放平台/合作方推送」提供签名、重放保护。

### 搜索、推荐与多媒体
- 全文检索：未集成 Elasticsearch/OpenSearch。可实现「书名/作者/标签搜索」「高亮/拼写纠错/自动补全」。
- 推荐与排序：当前仅 DB 查询，无召回/排序策略。可利用「协同过滤」「基于阅读/收藏的倒排索引」「Redis Sorted Set 热榜」做推荐与排行榜。
- 多媒体处理：对象存储仅生成预签名 URL，未做图片裁剪/压缩/水印/CDN。可上线「封面多规格」「防盗链」「图片审核」。
- 实时交互：无 WebSocket/SSE。可为「评论实时刷新」「作者在线状态」「弹幕/直播签约活动」提供实时通道。

### 运维、可观测与工程效率
- 可观测性：缺少 Actuator、Micrometer 指标、链路追踪（Zipkin/SkyWalking）、结构化日志与日志采集。可用于排查接口耗时、慢 SQL、消息堆积。
- 配置与环境：未用配置中心（Nacos/Apollo），本地 YAML 直配。可拆分 dev/test/prod，支持灰度与动态配置。
- 容器化与部署：无 Dockerfile/Compose/K8s 清单。可用于「一键启动依赖（MySQL/Redis/RabbitMQ）」「发布流水线」。
- CI/CD 与质量门禁：无测试目录、无覆盖率、无静态检查（Spotless/Checkstyle/PMD）。可通过「注册/登录/小说 CRUD」用例覆盖单元/集成测试与流水线校验。
- 性能与容量压测：未配置 Gatling/JMeter/JMH。可在「高并发抢先读」「大批量上传」场景下评估瓶颈。
- 灰度与特性开关：未使用 FF4J/Spring Cloud Feature Toggle。可为「新榜单算法」「付费模式」灰度发布。

### 业务侧可延展的需求示例（结合上述知识点）
- 付费体系：章节购买/订阅、月票/打赏结算（BigDecimal、分布式锁、事务、对账批处理）。
- 搜索与推荐：ES 索引构建、阅读埋点->实时热榜（Kafka/Redis Sorted Set/定时任务）。
- 内容安全与审核：异步审核队列、延迟重试、AI 审核回执、运营后台 RBAC。
- 通知中心：站内信/邮件/短信/WebSocket 推送，统一消息模版与状态回执。
- 活动与运营：限时免费、兑换券、抽奖（限流、幂等、分布式锁、定时下架）。
- 数据与监控：Actuator + Prometheus 监控接口/QPS/延迟，慢 SQL 警报，日志追踪登录与支付链路。

